<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Stock Prediction</title>

  <!-- Bootstrap for quick layout -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>

  <!-- Socket.IO for training progress (optional but supported) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>

  <!-- Chart.js for plots -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <link rel="stylesheet" href="/static/css/styles.css"/>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand font-weight-bold" href="#">Stock Prediction</a>
  </nav>

  <div class="container mt-5">
    <div class="row">
      <!-- Left Column -->
      <div class="col-md-6">
        <h2>Stock Actions</h2>

        <!-- Upload -->
        <div>
          <h3>Upload CSV</h3>
          <p>Upload a CSV file containing historical stock prices to process and analyze.</p>
          <form id="upload-form" enctype="multipart/form-data">
            <div class="form-group">
              <input type="file" name="file" id="file-input" class="form-control" required />
              <small class="form-text text-muted">Accepted format: CSV (must include a Date column and Close/Adj Close)</small>
            </div>
            <button type="submit" class="btn btn-primary">Upload</button>
          </form>
          <div id="upload-alert" class="alert alert-info mt-3" style="display:none">Uploading...</div>
        </div>

        <!-- Download -->
        <div class="mt-4">
          <h3>Download Stock Data</h3>
          <p>Enter a stock ticker to download the latest stock data for analysis.</p>
          <div class="form-group">
            <input type="text" id="ticker-input" placeholder="Enter Stock Ticker" class="form-control" required />
            <small class="form-text text-muted">Examples: TATAMOTORS, INFY, RELIANCE</small>
          </div>
          <button id="download-btn" class="btn btn-primary">Download</button>
          <div id="download-alert" class="alert alert-info mt-3" style="display:none">Downloading...</div>
        </div>

        <!-- Model & Actions -->
        <div id="model-section" class="mt-5" style="display:none;">
          <h3>Choose Model & Run</h3>

          <div class="form-row">
            <div class="form-group col-md-8">
              <label for="model-select">Model</label>
              <select id="model-select" class="form-control">
                <option value="lstm">LSTM (Price Regression)</option>
                <option value="linear">Linear Regression (Price)</option>
                <option value="rf">Random Forest (Price)</option>
                <option value="svm">SVM / SVR (Price)</option>
                <option value="xgb">XGBoost (Price)</option>
                <option value="logit">Logistic (Direction Up/Down)</option>
              </select>
            </div>
            <div class="form-group col-md-4">
              <label for="time-step-input">time_step</label>
              <input id="time-step-input" type="number" class="form-control" value="60" min="2" />
            </div>
          </div>

          <div class="form-group form-check">
            <input type="checkbox" class="form-check-input" id="retrain-checkbox" checked />
            <label class="form-check-label" for="retrain-checkbox">Retrain (save/overwrite artifacts)</label>
          </div>

          <div class="btn-group">
            <button id="train-btn" class="btn btn-success">Train</button>
            <button id="predict-btn" class="btn btn-outline-success">Predict (Fast)</button>
          </div>

          <div id="train-alert" class="alert alert-info mt-3" style="display:none;">Training...</div>
          <progress id="training-progress" value="0" max="100" style="display:none;width:100%"></progress>

          <div id="model-hint" class="small text-muted mt-2">
            LSTM/Linear/RF/SVM/XGB output a price. Logistic outputs a direction + probability.
          </div>

           Evaluate / Verify
          <hr class="my-4"/>
          <h4>Verify & Compare</h4>
          <p class="small text-muted mb-2">
            Evaluate all models on the same test window, then verify if yesterday’s prediction hit today’s actual close.
          </p>
          <div class="btn-toolbar mb-2">
            <div class="btn-group mr-2">
              <button id="evaluate-btn" class="btn btn-info">Evaluate All Models</button>
            </div>
            <div class="btn-group">
              <button id="verify-btn" class="btn btn-secondary">Verify Latest Prediction</button>
            </div>
          </div>
          <div id="evaluate-alert" class="alert alert-info mt-2" style="display:none;">Evaluating...</div>

          <div id="eval-results" class="mt-3" style="display:none;">
            <h5 class="mb-2">Evaluation Metrics</h5>
            <div class="table-responsive">
              <table id="eval-table" class="table table-sm table-striped table-bordered mb-0">
                <thead></thead>
                <tbody></tbody>
              </table>
            </div>
            <small class="form-text text-muted mt-1">
              Best values per metric are highlighted. All models use the same <code>time_step</code> and test span.
            </small>

            <div id="verify-alert" class="alert alert-info mt-3" style="display:none;">Verifying...</div>
            <pre id="verify-output" class="mt-2 small" style="display:none; background:#f9f9f9; padding:8px;"></pre>
          </div>
        </div>
      </div>

      <!-- Right Column -->
      <div class="col-md-6">
        <div id="results-section" class="mt-5">
          <h2>Results</h2>
          <p>Visualize the true stock prices with training & testing predictions (or probabilities for Logistic).</p>
          <canvas id="train-test-plot" width="800" height="400"></canvas>

          <div id="predictions-block" class="mt-4">
            <h3 class="mb-1">Prediction</h3>
            <div id="prediction-text" class="lead"></div>
          </div>

          <div id="error-block" class="alert alert-danger mt-3" style="display:none;"></div>

          <hr class="my-4"/>

          <!-- === Model Comparison === -->
          <div id="compare-section" class="mt-4">
            <h3 class="mb-3">Model Comparison</h3>

            <div class="d-flex align-items-center mb-2">
              <button id="compare-overlay-btn" class="btn btn-secondary mr-2">
                Compare Predictions (Test Overlay)
              </button>
              <!-- <button id="compare-metrics-btn" class="btn btn-outline-secondary">
                Show Metrics (Bar Chart)
              </button> -->
            </div>

            <div id="compare-alert" class="alert alert-info" style="display:none;">Working…</div>
            <div id="compare-error" class="alert alert-danger" style="display:none;"></div>

            <!-- Overlay chart: True prices + each model's test predictions -->
            <div class="card mb-6">
                <h5 class="card-title mb-2">Test Predictions Overlay</h5>
                <small class="text-muted">
                  Shows only the <em>test</em> portion of each regression model, aligned on the same timeline.
                </small>
                <canvas id="compare-overlay-chart" width="800" height="400"></canvas>
            </div>

            <!-- Metrics chart: RMSE by model -->
            <!-- <div class="card">
              <div class="card-body">
                <h5 class="card-title mb-2">Metrics Comparison</h5>
                <small class="text-muted">
                  RMSE lower is better. Using the same <code>time_step</code> and test window for all models.
                </small>
                <canvas id="metrics-bar-chart" height="280" class="mt-3"></canvas>
                <div id="metrics-note" class="small text-muted mt-2" style="display:none;"></div>
              </div>
            </div> -->
          </div><!-- /compare-section -->
        </div>
      </div>
    </div>
  </div>

  <script>
    window.API_BASE = ""; // same origin; set to "http://127.0.0.1:5000" if serving separately
  </script>
  <script src="/static/js/scripts.js"></script>
</body>
</html>
